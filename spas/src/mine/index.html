<html>

<head>
  <meta charset="utf-8">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="transparent">
  <meta name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <style>
    html,
    body,
    #app {
      height: 100%;
      min-height: 100%;
      margin: 0;
    }

    #app {
      position: fixed;
      left: 0px;
      right: 0px;
      top: 0px;
      bottom: 0px;
      overflow: hidden;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      background-image:
        radial-gradient(#FFCCCC, rgba(255, 255, 255, 0.2) 40px, transparent 80px),
        radial-gradient(#CCCCFF, rgba(255, 255, 255, 0.3) 30px, transparent 100px),
        radial-gradient(#99CCCC, rgba(255, 255, 255, 0.2) 30px, transparent 100px);
      background-size: 300px 300px, 200px 200px, 300px 300px;
      background-position: 0 0, 20px 40px, 70px 30px, 60px 80px;
    }

    #app>div {
      align-self: center;
      display: flex;
      align-items: center;
      text-align: center;
      height: 100%;
    }

    #cellsTable {
      -webkit-appearance: none;
      display: flex;
      flex-direction: column;
      align-self: center;
    }

    #cellsTable>.cellsRow {
      display: flex;
      flex: 1;
    }

    .cellsRow>input {
      -webkit-appearance: none;
      flex: 1;
      margin: 2px;
      padding: 0;
      min-width: 0;
      min-height: 0;
      border: 1px solid transparent;
      border-radius: 2px;
      box-sizing: border-box;
      box-shadow: 1px 1px 3px #888;
      overflow: hidden;
    }

    .cellsRow>input:focus {
      outline: 0;
    }

    *[data-char="0"] {
      background: #CCCCCCC0 !important;
    }

    *[data-char="1"] {
      background: #99CC66C0 !important;
    }

    *[data-char="2"] {
      background: #CCCCFFC0 !important;
    }

    *[data-char="3"] {
      background: #CCCC99C0 !important;
    }

    *[data-char="4"] {
      background: #FFCCCCC0 !important;
    }

    *[data-char="5"] {
      background: #99CCCCC0 !important;
    }

    *[data-char="6"] {
      background: #FFFFCCC0 !important;
    }

    *[data-char="7"] {
      background: #E9AE6AC0 !important;
    }

    *[data-char="8"] {
      background: #CC9999C0 !important;
    }

    .mine.fail {
      background: transparent !important;
      box-shadow: 0 0 0;
      color: #FF6666;
    }

    .mine.success {
      color: #99CC6680;
    }

    .devider {
      flex: 4;
    }

    .devider-mini {
      flex: 1;
    }

    input.flipped {
      background: transparent !important;
      box-shadow: 0 0 0;
      color: #666;
    }

    @media (orientation:landscape) {}
  </style>
  <script>
    "use strict"
    class App {
      constructor() { }
      initComponents() {
        ['cellsTable'].forEach(n => {
          this[n] = document.getElementById(n);
        })
        this.start();
      }

      updateMines(success) {
        this.cells.forEach(cs => cs.forEach(c => {
          if (c.isMine) {
            c.btn.value = success ? '⚑' : '☣';
            c.btn.classList.add(success ? 'success' : 'fail');
          }
        }));
      }

      select(cell) {
        if (!this.isRunning) {
          this.start();
          return;
        }
        if (cell.isFliped) {
          return;
        }
        if (cell.isMine) {
          this.isRunning = false;
          this.updateMines(false);
          return;
        }

        this.flipCell(cell);
        if (this.remainCells <= this.mineCount) {
          this.isRunning = false;
          this.updateMines(true);
          return;
        }
      }


      flipCell(cell) {
        if (cell.isFliped) {
          return;
        }
        this.remainCells--;
        cell.isFliped = true;
        cell.btn.classList.add('flipped');
        let {
          i,
          j
        } = cell;
        let mineCount = 0;
        let nCells = [];
        let iMin = Math.max(0, i - 1);
        let iMax = Math.min(this.width, i + 2);
        let jMin = Math.max(0, j - 1);
        let jMax = Math.min(this.height, j + 2);
        for (var s = jMin; s < jMax; s++) {
          for (var r = iMin; r < iMax; r++) {
            if (r === i && s === j) {
              continue;
            }
            const nCell = this.cells[s][r];
            if (nCell.isMine) {
              mineCount++;
            } else {
              nCells.push(nCell);
            }
          }
        }
        if (mineCount == 0) {
          for (var c of nCells) {
            this.flipCell(c);
          }
        } else {
          cell.btn.value = mineCount;
        }
      }

      calculateSize() {
        let cellWidth = 36;
        this.width = Math.floor(window.innerWidth / cellWidth);
        this.height = Math.floor(window.innerHeight / cellWidth);
        this.cellsTable.style.width = `${this.width * cellWidth}px`;
        this.cellsTable.style.height = `${this.height * cellWidth}px`;
      }

      start() {
        this.calculateSize();
        this.isRunning = true;
        this.cellsTable.innerHTML = '';
        this.cellsCount = this.width * this.height;
        this.remainCells = this.cellsCount;
        let mineOp = 0.2;
        this.cells = [];
        this.mineCount = 0;
        for (let j = 0; j < this.height; j++) {
          var raw = [];
          this.cells.push(raw);
          var cellsRow = document.createElement('div');
          cellsRow.classList.add('cellsRow')
          this.cellsTable.appendChild(cellsRow);
          for (let i = 0; i < this.width; i++) {
            let cell = {
              i,
              j
            };
            raw.push(cell);
            if (Math.random() < mineOp) {
              cell.isMine = true;
              this.mineCount++;
            }
            var btn = document.createElement('input');
            btn.type = 'button';
            btn.dataset.char = Math.floor(Math.random() * 9)
            if (cell.isMine) {
              btn.classList.add('mine');
            }
            btn.onclick = () => this.select(cell);
            cell.btn = btn;
            cellsRow.appendChild(btn);
          }
        }
      }
    }

    window.onload = () => {
      new App().initComponents();
    }
  </script>
</head>

<body>
  <div id="app">
    <div>
      <div id="cellsTable" style="width: 684px; height: 468px;">
        <div class="cellsRow"><input type="button" data-char="0"><input type="button" data-char="6"><input type="button"
            data-char="6"><input type="button" data-char="0"><input type="button" data-char="1" class="mine"><input
            type="button" data-char="2"><input type="button" data-char="2"><input type="button" data-char="0"><input
            type="button" data-char="8"><input type="button" data-char="8" class="mine"><input type="button"
            data-char="3"><input type="button" data-char="5"><input type="button" data-char="6"><input type="button"
            data-char="6"><input type="button" data-char="3"><input type="button" data-char="6"><input type="button"
            data-char="3"><input type="button" data-char="7"><input type="button" data-char="1"></div>
        <div class="cellsRow"><input type="button" data-char="4"><input type="button" data-char="0"><input type="button"
            data-char="5"><input type="button" data-char="4"><input type="button" data-char="1"><input type="button"
            data-char="5"><input type="button" data-char="3"><input type="button" data-char="5"><input type="button"
            data-char="4"><input type="button" data-char="1" class="mine"><input type="button" data-char="4"><input
            type="button" data-char="8"><input type="button" data-char="2"><input type="button" data-char="4"
            class="mine"><input type="button" data-char="8"><input type="button" data-char="2"><input type="button"
            data-char="8"><input type="button" data-char="5"><input type="button" data-char="1"></div>
        <div class="cellsRow"><input type="button" data-char="1"><input type="button" data-char="1"><input type="button"
            data-char="1"><input type="button" data-char="4" class="mine"><input type="button" data-char="3"><input
            type="button" data-char="3" class="mine"><input type="button" data-char="0"><input type="button"
            data-char="8"><input type="button" data-char="0"><input type="button" data-char="4"><input type="button"
            data-char="7"><input type="button" data-char="6"><input type="button" data-char="2"><input type="button"
            data-char="4"><input type="button" data-char="5"><input type="button" data-char="5"><input type="button"
            data-char="5"><input type="button" data-char="1"><input type="button" data-char="4"></div>
        <div class="cellsRow"><input type="button" data-char="3" class="mine"><input type="button" data-char="6"><input
            type="button" data-char="3"><input type="button" data-char="8"><input type="button" data-char="1"><input
            type="button" data-char="5"><input type="button" data-char="1"><input type="button" data-char="4"><input
            type="button" data-char="7"><input type="button" data-char="1"><input type="button" data-char="4"><input
            type="button" data-char="7"><input type="button" data-char="3"><input type="button" data-char="1"><input
            type="button" data-char="0"><input type="button" data-char="0"><input type="button" data-char="8"><input
            type="button" data-char="3"><input type="button" data-char="1" class="mine"></div>
        <div class="cellsRow"><input type="button" data-char="4"><input type="button" data-char="0"><input type="button"
            data-char="8"><input type="button" data-char="7" class="mine"><input type="button" data-char="2"
            class="mine"><input type="button" data-char="4"><input type="button" data-char="0"><input type="button"
            data-char="0"><input type="button" data-char="3"><input type="button" data-char="7"><input type="button"
            data-char="5"><input type="button" data-char="8"><input type="button" data-char="8"><input type="button"
            data-char="5"><input type="button" data-char="4"><input type="button" data-char="1"><input type="button"
            data-char="0"><input type="button" data-char="8"><input type="button" data-char="5"></div>
        <div class="cellsRow"><input type="button" data-char="4" class="mine"><input type="button" data-char="5"><input
            type="button" data-char="7"><input type="button" data-char="1"><input type="button" data-char="5"><input
            type="button" data-char="7"><input type="button" data-char="2"><input type="button" data-char="2"><input
            type="button" data-char="2" class="mine"><input type="button" data-char="7"><input type="button"
            data-char="1"><input type="button" data-char="7"><input type="button" data-char="8"><input type="button"
            data-char="7" class="mine"><input type="button" data-char="5" class="mine"><input type="button"
            data-char="5"><input type="button" data-char="3"><input type="button" data-char="4"><input type="button"
            data-char="2"></div>
        <div class="cellsRow"><input type="button" data-char="0"><input type="button" data-char="8"><input type="button"
            data-char="5"><input type="button" data-char="3"><input type="button" data-char="6"><input type="button"
            data-char="2"><input type="button" data-char="8"><input type="button" data-char="8"><input type="button"
            data-char="1"><input type="button" data-char="1"><input type="button" data-char="2"><input type="button"
            data-char="6"><input type="button" data-char="7"><input type="button" data-char="5"><input type="button"
            data-char="2" class="mine"><input type="button" data-char="0" class="mine"><input type="button"
            data-char="4"><input type="button" data-char="7"><input type="button" data-char="7"></div>
        <div class="cellsRow"><input type="button" data-char="1"><input type="button" data-char="6"><input type="button"
            data-char="5"><input type="button" data-char="5"><input type="button" data-char="0" class="mine"><input
            type="button" data-char="6" class="mine"><input type="button" data-char="6"><input type="button"
            data-char="7"><input type="button" data-char="2"><input type="button" data-char="7"><input type="button"
            data-char="3"><input type="button" data-char="5"><input type="button" data-char="0" class="mine"><input
            type="button" data-char="1"><input type="button" data-char="8" class="mine"><input type="button"
            data-char="4" class="mine"><input type="button" data-char="8"><input type="button" data-char="0"><input
            type="button" data-char="7"></div>
        <div class="cellsRow"><input type="button" data-char="7"><input type="button" data-char="7"><input type="button"
            data-char="2"><input type="button" data-char="5"><input type="button" data-char="8"><input type="button"
            data-char="7"><input type="button" data-char="3" class="mine"><input type="button" data-char="3"><input
            type="button" data-char="2" class="mine"><input type="button" data-char="8" class="mine"><input
            type="button" data-char="2"><input type="button" data-char="1"><input type="button" data-char="5"><input
            type="button" data-char="6"><input type="button" data-char="0"><input type="button" data-char="8"><input
            type="button" data-char="8"><input type="button" data-char="6"><input type="button" data-char="8"></div>
        <div class="cellsRow"><input type="button" data-char="5"><input type="button" data-char="6"><input type="button"
            data-char="5"><input type="button" data-char="7"><input type="button" data-char="0"><input type="button"
            data-char="2" class="mine"><input type="button" data-char="7"><input type="button" data-char="0"><input
            type="button" data-char="6"><input type="button" data-char="4"><input type="button" data-char="1"><input
            type="button" data-char="4" class="mine"><input type="button" data-char="3"><input type="button"
            data-char="2"><input type="button" data-char="3"><input type="button" data-char="0" class="mine"><input
            type="button" data-char="6"><input type="button" data-char="2" class="mine"><input type="button"
            data-char="8"></div>
        <div class="cellsRow"><input type="button" data-char="8"><input type="button" data-char="1" class="mine"><input
            type="button" data-char="4" class="mine"><input type="button" data-char="5"><input type="button"
            data-char="8"><input type="button" data-char="5"><input type="button" data-char="1"><input type="button"
            data-char="8"><input type="button" data-char="8"><input type="button" data-char="1"><input type="button"
            data-char="8"><input type="button" data-char="3"><input type="button" data-char="1"><input type="button"
            data-char="8"><input type="button" data-char="5"><input type="button" data-char="0" class="mine"><input
            type="button" data-char="4"><input type="button" data-char="3"><input type="button" data-char="1"></div>
        <div class="cellsRow"><input type="button" data-char="4"><input type="button" data-char="2"><input type="button"
            data-char="8"><input type="button" data-char="3" class="mine"><input type="button" data-char="3"><input
            type="button" data-char="1"><input type="button" data-char="0"><input type="button" data-char="3"><input
            type="button" data-char="6"><input type="button" data-char="4"><input type="button" data-char="4"
            class="mine"><input type="button" data-char="0"><input type="button" data-char="0"><input type="button"
            data-char="7"><input type="button" data-char="1" class="mine"><input type="button" data-char="3"><input
            type="button" data-char="3"><input type="button" data-char="3"><input type="button" data-char="8"></div>
        <div class="cellsRow"><input type="button" data-char="5" class="mine"><input type="button" data-char="0"><input
            type="button" data-char="1"><input type="button" data-char="3"><input type="button" data-char="6"
            class="mine"><input type="button" data-char="7" class="mine"><input type="button" data-char="0"
            class="mine"><input type="button" data-char="5"><input type="button" data-char="2" class="mine"><input
            type="button" data-char="8"><input type="button" data-char="3"><input type="button" data-char="3"><input
            type="button" data-char="4"><input type="button" data-char="5"><input type="button" data-char="2"><input
            type="button" data-char="3"><input type="button" data-char="2" class="mine"><input type="button"
            data-char="6"><input type="button" data-char="7" class="mine"></div>
      </div>
    </div>
  </div>
  </div>
</body>

</html>